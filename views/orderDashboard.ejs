<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Dashboard - Repawblic Pets</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&display=swap">
  <link rel="stylesheet" href="/css/shelter.css">
</head>
<body>
	<%- include('partials/navbar') %>

	<main>
		<header>
			<p class="muted">Admin · Order Management</p>
			<h1>Order Dashboard</h1>
			<p class="muted">Overview of all customer orders</p>
		</header>

		<div class="grid" style="margin-bottom:18px;">
			<article class="card">
				<h2 style="margin:0 0 6px; font-size:16px; color:var(--muted);">Total Orders</h2>
				<div style="font-size:26px; font-weight:700; color:var(--text);"><%= totals.orders %></div>
			</article>
			<article class="card">
				<h2 style="margin:0 0 6px; font-size:16px; color:var(--muted);">Total Revenue</h2>
				<div style="font-size:26px; font-weight:700; color:var(--text);">$<%= (Number(totals.revenue || 0) / 100).toFixed(2) %></div>
			</article>
			<article class="card">
				<h2 style="margin:0 0 6px; font-size:16px; color:var(--muted);">Total Discounts</h2>
				<div style="font-size:26px; font-weight:700; color:var(--text);">$<%= (Number(totals.discount || 0) / 100).toFixed(2) %></div>
			</article>
			<article class="card">
				<h2 style="margin:0 0 6px; font-size:16px; color:var(--muted);">Items Sold</h2>
				<div style="font-size:26px; font-weight:700; color:var(--text);"><%= totals.items %></div>
			</article>
		</div>

		<section class="card">
			<% if (!orders || !orders.length) { %>
				<p class="muted" style="text-align:center; padding:40px;">No orders found</p>
			<% } else { %>
				<div class="table-wrap">
					<table class="table">
						<thead>
							<tr>
								<th>Order #</th>
								<th>Customer</th>
								<th>Voucher</th>
								<th>Items</th>
								<th>Subtotal</th>
								<th>Total</th>
								<th>Created</th>
							</tr>
						</thead>
						<tbody>
							<% orders.forEach(o => { %>
								<tr>
									<td><strong>#<%= o.order_id %></strong></td>
									<td><%= o.username || `User #${o.user_id}` %></td>
									<td><%= o.voucher_code || '—' %></td>
									<td><%= o.item_count || 0 %></td>
									<td>$<%= (Number(o.subtotal || 0) / 100).toFixed(2) %></td>
									<td>$<%= (Number(o.total || 0) / 100).toFixed(2) %></td>
									<td><%= new Date(o.created_at).toLocaleDateString() %></td>
								</tr>
							<% }); %>
						</tbody>
					</table>
				</div>
			<% } %>
		</section>
	</main>

	<%- include('partials/footer') %>
		.container {
			max-width: 1200px;
			margin: 40px auto;
			padding: 0 20px 60px;
		}
		.page-header {
			background: #fff;
			border-radius: 12px;
			padding: 20px 24px;
			margin-bottom: 18px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 4px 10px rgba(0,0,0,0.06);
		}
		h1 { margin: 0; color: #ff6b9d; font-size: 28px; }
		.muted { color: #6b7280; font-size: 14px; }
		.cards {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
			gap: 14px;
			margin-bottom: 18px;
		}
		.card {
			background: #fff;
			border-radius: 12px;
			padding: 16px 18px;
			box-shadow: 0 4px 10px rgba(0,0,0,0.06);
		}
		.card h3 { margin: 0 0 6px; font-size: 16px; color: #6b7280; }
		.card .value { font-size: 26px; font-weight: 700; color: #111827; }
		.table-card { overflow: hidden; padding: 0; }
		table { width: 100%; border-collapse: collapse; }
		thead { background: #f3f4f6; }
		th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
		tbody tr:hover { background: #f9fafb; }
		.pill { display: inline-block; padding: 4px 10px; border-radius: 10px; background: #f3f4f6; font-size: 12px; }
		.empty { padding: 40px; text-align: center; color: #6b7280; }
		@media (max-width: 768px) {
			th:nth-child(6), td:nth-child(6) { display: none; }
		}
	</style>
</head>
<body>
	<%- include('partials/navbar') %>
	<div class="container">
		<div class="page-header">
			<div>
				<h1>Order Dashboard</h1>
				<div class="muted">Overview of all orders</div>
			</div>
		</div>

		<div class="cards">
			<div class="card">
				<h3>Total Orders</h3>
				<div class="value"><%= totals.orders %></div>
			</div>
			<div class="card">
				<h3>Total Revenue</h3>
				<div class="value">$<%= (Number(totals.revenue || 0) / 100).toFixed(2) %></div>
			</div>
			<div class="card">
				<h3>Total Discounts</h3>
				<div class="value">$<%= (Number(totals.discount || 0) / 100).toFixed(2) %></div>
			</div>
			<div class="card">
				<h3>Items Sold</h3>
				<div class="value"><%= totals.items %></div>
			</div>
		</div>

		<div class="card table-card">
			<% if (orders && orders.length) { %>
				<table>
					<thead>
						<tr>
							<th>Order #</th>
							<th>Customer</th>
							<th>Voucher</th>
							<th>Items</th>
							<th>Subtotal</th>
							<th>Discount</th>
							<th>Total</th>
						</tr>
					</thead>
					<tbody>
						<% orders.forEach(o => { %>
							<tr>
								<td><strong>#<%= o.order_id %></strong></td>
								<td>
									<div><%= o.username || 'User ' + o.user_id %></div>
									<div class="muted" style="font-size:12px;"><%= o.email || '' %></div>
								</td>
								<td>
									<% if (o.voucher_code) { %>
										<span class="pill"><%= o.voucher_code %></span>
									<% } else { %>
										<span class="muted">—</span>
									<% } %>
								</td>
								<td><%= o.units_count || 0 %> units / <%= o.items_count || 0 %> lines</td>
								<td>$<%= (Number(o.subtotal || 0) / 100).toFixed(2) %></td>
								<td>$<%= (Number(o.discount_amount || 0) / 100).toFixed(2) %></td>
								<td>$<%= (Number(o.total_amount || 0) / 100).toFixed(2) %></td>
							</tr>
						<% }); %>
					</tbody>
				</table>
			<% } else { %>
				<div class="empty">No orders found.</div>
			<% } %>
		</div>
	</div>
	<%- include('partials/footer') %>
</body>
</html>
