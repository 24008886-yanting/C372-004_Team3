<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Messages | Repawblic Pets</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&family=Space+Grotesk:wght@500;700&display=swap">
    <link rel="stylesheet" href="/css/adminContact.css">
  </head>
  <body class="admin-contact-body">
    <%- include('partials/navbar') %>

    <main class="admin-contact-main">
      <header class="page-header">
        <p class="subhead">Admin inbox</p>
        <h1>Contact Messages</h1>
        <p class="muted">Review user submissions and respond.</p>
      </header>

      <section class="card">
        <% if (typeof success !== 'undefined') { %>
          <div class="alert success"><%= success %></div>
        <% } %>
        <% if (typeof error !== 'undefined') { %>
          <div class="alert error"><%= error %></div>
        <% } %>

        <% if (messages && messages.length) { %>
          <div class="message-list">
            <% messages.forEach(function(message) { %>
              <article class="message-card">
                <div class="message-header">
                  <div>
                    <p class="eyebrow">Message</p>
                    <h2><%= message.subject || 'No subject' %></h2>
                  </div>
                  <span class="status <%= (message.status || 'pending').toLowerCase() %>">
                    <%= message.status || 'Pending' %>
                  </span>
                </div>

                <div class="meta-grid">
                  <div>
                    <span class="label">Email</span>
                    <span><%= message.email || 'N/A' %></span>
                  </div>
                  <div>
                    <span class="label">Username</span>
                    <span><%= message.username || 'Unknown' %></span>
                  </div>
                  <div>
                    <span class="label">Role</span>
                    <span><%= message.user_role || 'Unknown' %></span>
                  </div>
                  <div>
                    <span class="label">Submitted</span>
                    <span>
                      <%= message.created_at
                        ? new Date(message.created_at).toLocaleString('en-GB', {
                            year: 'numeric',
                            month: 'short',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                          })
                        : 'N/A' %>
                    </span>
                  </div>
                </div>

                <p class="message-body"><%= message.message || '' %></p>

                <% if (message.admin_notes) { %>
                  <div class="reply-display">
                    <span class="label">Admin reply</span>
                    <p><%= message.admin_notes %></p>
                  </div>
                <% } %>

                <% if ((message.status || '').toLowerCase() !== 'replied') { %>
                  <details class="reply-box">
                    <summary>Reply</summary>
                    <form action="/admin/messages/<%= message.message_id %>/reply" method="POST" class="reply-form">
                      <label for="reply_<%= message.message_id %>">Response</label>
                      <textarea
                        id="reply_<%= message.message_id %>"
                        name="reply"
                        rows="4"
                        maxlength="2000"
                        placeholder="Write your reply here..."
                        required
                      ></textarea>
                      <div class="reply-actions">
                        <button type="submit" class="btn">Send Reply</button>
                      </div>
                    </form>
                  </details>
                <% } %>
              </article>
            <% }); %>
          </div>
        <% } else { %>
          <p class="muted">No contact messages yet.</p>
        <% } %>
      </section>
    </main>
  </body>
</html>
