<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vouchers | Repawblic Pets</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700&display=swap">
  <link rel="stylesheet" href="/css/shelter.css">
  <style>
    .status-note { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .badge-active { background: #dcfce7; color: #15803d; }
    .badge-used { background: #fee2e2; color: #991b1b; }
    .badge-expired { background: #fef3c7; color: #92400e; }
  </style>
</head>
<body>
  <%- include('partials/navbar') %>

  <main>
    <header>
      <p class="muted">Admin - Voucher Management</p>
      <h1>Vouchers</h1>
      <p class="muted">View voucher codes and their validity</p>
    </header>

    <section class="card">
      <div class="table-header">
        <span class="muted">Total vouchers: <%= vouchers && vouchers.length ? vouchers.length : 0 %></span>
        <a href="/vouchers/new" class="btn">Create Voucher</a>
      </div>

      <% if (vouchers && vouchers.length) { %>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Code</th>
                <th>Discount</th>
                <th>Expires</th>
                <th>Status</th>
                <th>Usage</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% vouchers.forEach(v => { %>
                <tr>
                  <td><strong><%= v.voucher_code %></strong></td>
                  <td>
                    <%= v.discount_type === 'percentage' ? v.discount_value + '% off' : '$' + Number(v.discount_value).toFixed(2) + ' off' %>
                  </td>
                  <td>
                    <%= v.expiry_date ? new Date(v.expiry_date).toLocaleDateString() : 'No expiry' %>
                  </td>
                  <td>
                    <% if (v.status === 'Expired') { %>
                      <span class="badge badge-expired">Expired</span>
                    <% } else if (v.status === 'Used Up') { %>
                      <span class="badge badge-used">Used Up</span>
                    <% } else { %>
                      <span class="badge badge-active">Active</span>
                    <% } %>
                    <% if (v.statusReason) { %>
                      <div class="status-note"><%= v.statusReason %></div>
                    <% } %>
                  </td>
                  <td>
                    <% const limit = Number(v.usage_limit || 0); const used = Number(v.used_count || 0); %>
                    <%= used %> / <%= limit || 'Unlimited' %>
                  </td>
                  <td>
                    <a href="/vouchers/<%= v.voucher_id %>/edit" class="btn outline">Edit</a>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="muted table-empty">No vouchers found.</p>
      <% } %>
    </section>
  </main>
</body>
</html>
